# housing-sim-jp

日本の住宅戦略を比較する資産形成シミュレーター。2026年以降の日本市場を前提に、開始年齢から80歳までの月次シミュレーションを実行し、税引後純資産を比較する。

## 前提条件

### 世帯・ライフプラン
- **対象世帯**: 一都三県勤務の共働きカップル（同い年）、大手企業正社員
- **居住エリア**: 職住近接・都心まで30分以内を前提（浦和駅エリア想定）
- **シミュレーション期間**: 開始年齢（20〜45歳）から80歳まで。80歳で老人ホーム入居を出口戦略とし、以降のバリアフリー改修等は考慮外
- **教育費**: 子の7〜22歳の16年間、ステージ別按分モデル。`--education` はピーク（高校）金額を指定（デフォルト10万/人/月、インフレ連動）

| ステージ | 子の年齢 | 割合 | --education 15の場合 |
|---------|---------|------|---------------------|
| 小学校   | 7-12歳  | 0.4  | 6.0万/月 |
| 中学校   | 13-15歳 | 0.7  | 10.5万/月 |
| **高校** | 16-18歳 | **1.0** | **15.0万/月** |
| 大学     | 19-22歳 | 0.85 | 12.8万/月 |

### 収入・年金
- **収入モデル**: 〜34歳は年3%成長、35歳〜は年1.5%成長、60歳で再雇用（ピークの60%）、70歳で年金生活
- **年金**: 公的年金（基礎年金+厚生年金）をピーク収入から動的計算 + 企業年金（デフォルト130万/年）

### 住宅購入
- **物件価格**: 2026年の浦和駅エリア実勢価格
- **住宅ローン**: フルローン35年・変動金利（5年ごとステップ式）。銀行審査基準（年収倍率≤7倍、返済比率≤35%）を適用
- **初期資産**: 購入戦略の諸費用（マンション606万・一戸建て524万・賃貸105万）を賄えること

### 資産運用・税務
- **投資先**: 全世界株式インデックス。NISA（夫婦合計3,600万円上限・非課税）を優先し、超過分は特定口座（課税20.315%）
- **不動産売却**: 居住用財産3,000万円特別控除を適用

## 比較戦略

| 戦略 | 概要 |
|------|------|
| **浦和マンション** | 築10年中古マンション購入（7,580万円）。管理費+修繕積立金が築年数で段階増額 |
| **浦和一戸建て** | 築7年中古一戸建て購入（6,547万円）。大規模修繕を一時費用で計上 |
| **戦略的賃貸** | ライフステージに応じて3フェーズで家賃ダウンサイジング（2LDK→3LDK→2LDK） |
| **通常賃貸** | 3LDK固定で全期間賃貸 |

## 使い方

```bash
# 単体シミュレーション（確定論: 3戦略比較）
python -m housing_sim_jp.cli

# 3シナリオ×4戦略比較（確定論: 低成長/標準/高成長 + 投資規律の感度分析）
python -m housing_sim_jp.scenario_cli

# Monte Carlo シミュレーション（確率論: N=1,000試行 + イベントリスク）
python -m housing_sim_jp.monte_carlo_cli
python -m housing_sim_jp.monte_carlo_cli --mc-runs 5000 --volatility 0.20
python -m housing_sim_jp.monte_carlo_cli --no-events  # イベントリスクなし

# テスト
python -m pytest tests/ -v
```

### 設定ファイル

`config.example-30.toml` や `config.example-35.toml` をコピーして `config.toml` を作成すると、CLIフラグのデフォルト値を上書きできます。

```bash
cp config.example-30.toml config.toml   # 30歳プリセット（800万/62.5万/子2人）
cp config.example-35.toml config.toml   # 35歳プリセット（1500万/75万/子1人/教育費ピーク18万）
# config.toml を編集して個人設定を反映
python -m housing_sim_jp.cli                              # config.toml を自動読み込み
python -m housing_sim_jp.cli --config my_config.toml      # 任意のパスを指定
python -m housing_sim_jp.cli --config config.toml --age 40  # CLIフラグで個別に上書き
```

**優先順位**: CLIフラグ > config.toml > ハードコードデフォルト

### オプション

| フラグ | 説明 | デフォルト |
|--------|------|-----------|
| `--config` | 設定ファイルパス | config.toml（存在時のみ） |
| `--age` | 開始年齢（20〜45歳） | 30 |
| `--savings` | 初期金融資産（万円） | 800 |
| `--income` | 世帯月額手取り（万円） | 62.5 |
| `--children` | 出産時の親の年齢（カンマ区切り、最大2人） | 32,35 |
| `--living` | 夫婦の生活費（万円/月、住居費・教育費・子供分除く） | 27.0 |
| `--child-living` | 子1人あたりの追加生活費（万円/月） | 5.0 |
| `--education` | 教育費ピーク（高校）金額（万円/月/人） | 10.0 |
| `--car` | 車所有（購入300万/7年買替+維持費5万/月を計上） | なし |

Monte Carlo 固有オプション（`monte_carlo_cli` のみ）:

| フラグ | 説明 | デフォルト |
|--------|------|-----------|
| `--mc-runs` | シミュレーション回数 | 1000 |
| `--volatility` | 投資リターンのボラティリティ σ | 0.15 |
| `--seed` | 乱数シード | 42 |
| `--no-events` | イベントリスク（失業・災害・介護・入居拒否）を無効化 | 有効 |

- **生活費**: 夫婦ベース27万＋子供1人あたり5万で動的に計算。子1人の場合は合計32万、子2人で37万、子なしで27万
- **教育費**: `--children` から自動計算（各子の7〜22歳 = 小学校入学〜大学卒業の16年間、ステージ別按分）
- **子なし**: `--children none` で教育費・子供生活費ゼロ。TOMLでは `children = []`
- **子供上限**: 3LDKの部屋数制約により最大2人。3人以上はエラー
- **戦略的賃貸の3LDKフェーズ**: 子供の在学期間（最初の子の小学校入学〜最後の子の大学卒業）に連動。子なしの場合は全期間2LDK

## 経済シナリオ

| パラメータ | 低成長 | 標準 | 高成長 |
|-----------|--------|------|--------|
| インフレ率 | 0.5% | 1.5% | 2.5% |
| 運用利回り | 4.0% | 5.5% | 7.0% |
| 土地上昇率 | 0.0% | 0.5% | 1.0% |
| ローン金利 | 0.75→1.25% | 0.75→2.00% | 1.00→3.00% |

## Monte Carlo シミュレーション

確定論モデル（固定リターン5.5%）では見えない**市場変動リスク**と**生活イベントリスク**を定量化する。

**市場変動（年次サンプリング）:**
- 投資リターン: 対数正規分布（期待値5.5%、σ=15%）— 年ごとに変動
- インフレ率・土地上昇率: 正規分布（ラン単位で固定、相関0.6）

**生活イベント:**
- 失業（年2%、6ヶ月間、最大2回）
- 災害（年0.5%、物件価値30%毀損・保険50%カバー）
- 介護（75歳以降年5%、月15万円）
- 入居拒否（70歳以降年10%、賃貸のみ月5万円追加）

**出力:** P5/P25/P50/P75/P95のパーセンタイル分布、一時的資産枯渇経験率、ストレステスト結果

## 分析レポート

| レポート | 条件 |
|---------|------|
| [report-30.md](report-30.md) | 30歳・800万・手取り62.5万・子2人（32,35歳出産）・教育費ピーク14万/月 |
| [report-35.md](report-35.md) | 35歳・1500万・手取り75万・子1人（37歳出産）・教育費ピーク18万/月 |
